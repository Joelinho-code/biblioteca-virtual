<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acceso Administrativo - Biblioteca IUTTOL</title>
    <link rel="stylesheet" href="css/principal.css">
    <link rel="stylesheet" href="css/formulario.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>
    <header>
        <div class="logo">
            <img src="image/logo_iutol_400x400-removebg-preview.png" alt="Logo IUTTOL">
            <div class="header-text">
                <h1>Acceso Administrativo</h1>
                <h2>Registro de Trabajos Especiales de Grado</h2>
            </div>
        </div>
    </header>

    <nav class="main-nav">
        <ul>
            <li><a href="index.html"><i class="fas fa-home"></i> Inicio</a></li>
            <li><a href="consultas.html"><i class="fas fa-search"></i> Consultar TEGs</a></li>
            <li><a href="formulario.html" class="active"><i class="fas fa-sign-in-alt"></i> Acceso Administrativo</a></li>
        </ul>
    </nav>

    <main class="form-main">
        <section class="login-section" id="login-section">
            <h2>Iniciar Sesión</h2>
            <form id="login-form">
                <div class="form-group">
                    <label for="username"><i class="fas fa-user"></i> Usuario:</label>
                    <input type="text" id="username" required>
                </div>
                <div class="form-group">
                    <label for="password"><i class="fas fa-lock"></i> Contraseña:</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit" class="btn primary"><i class="fas fa-sign-in-alt"></i> Ingresar</button>
            </form>
        </section>

        <section class="admin-section" id="admin-section" style="display: none;">
            <h2>Panel de Administración</h2>
            <div class="admin-actions">
                <button id="add-teg-btn" class="btn primary"><i class="fas fa-plus"></i> Agregar Nuevo TEG</button>
                <button id="view-tegs-btn" class="btn secondary"><i class="fas fa-list"></i> Ver Todos los TEGs</button>
                <button id="logout-btn" class="btn warning"><i class="fas fa-sign-out-alt"></i> Cerrar Sesión</button>
            </div>

            <div class="teg-form" id="teg-form">
                <h3><i class="fas fa-file-alt"></i> Registrar Nuevo Trabajo Especial de Grado</h3>
                <form id="teg-registration-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="teg-titulo">Título del Trabajo:</label>
                            <input type="text" id="teg-titulo" required>
                        </div>
                        <div class="form-group">
                            <label for="teg-carrera">Carrera:</label>
                            <select id="teg-carrera" required>
                                <option value="">Seleccione una carrera</option>
                                <option value="1">Administración</option>
                                <option value="2">Contaduría</option>
                                <option value="3">Informática</option>
                                <option value="4">Educación Preescolar</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="teg-autor">Autor(es):</label>
                            <input type="text" id="teg-autor" required>
                        </div>
                        <div class="form-group">
                            <label for="teg-tutor">Tutor:</label>
                            <input type="text" id="teg-tutor" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="teg-fecha">Fecha (Mes/Año):</label>
                            <input type="month" id="teg-fecha" required>
                        </div>
                        <div class="form-group">
                            <label for="teg-status">Estatus:</label>
                            <select id="teg-status" required>
                                <option value="Vigente">Vigente</option>
                                <option value="Archivado">Archivado</option>
                                <option value="Descartado">Descartado</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="teg-resumen">Resumen:</label>
                        <textarea id="teg-resumen" rows="4" required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="teg-archivo">Archivo PDF:</label>
                        <input type="file" id="teg-archivo" accept=".pdf" required>
                        <small>Formatos aceptados: PDF (Tamaño máximo: 10MB)</small>
                    </div>

                    <div class="form-group">
                        <label for="teg-palabras-clave">Palabras clave (separadas por comas):</label>
                        <input type="text" id="teg-palabras-clave">
                    </div>

                    <div class="form-buttons">
                        <button type="submit" class="btn primary"><i class="fas fa-save"></i> Guardar TEG</button>
                        <button type="reset" class="btn secondary"><i class="fas fa-undo"></i> Limpiar</button>
                    </div>
                </form>
            </div>

            <div class="teg-list" id="teg-list" style="display: none;">
                <h3><i class="fas fa-list-ul"></i> Listado de Trabajos Especiales de Grado</h3>
                <div class="list-controls">
                    <div class="search-control">
                        <input type="text" id="admin-search" placeholder="Buscar TEGs...">
                        <button id="admin-search-btn"><i class="fas fa-search"></i></button>
                    </div>
                    <div class="filter-control">
                        <label for="admin-filter">Filtrar por:</label>
                        <select id="admin-filter">
                            <option value="all">Todos</option>
                            <option value="1">Administración</option>
                            <option value="2">Contaduría</option>
                            <option value="3">Informática</option>
                            <option value="4">Educación Preescolar</option>
                        </select>
                    </div>
                </div>

                <div class="table-container">
                    <table id="admin-teg-table">
                        <thead>
                            <tr>
                                <th>Título</th>
                                <th>Autor(es)</th>
                                <th>Carrera</th>
                                <th>Fecha</th>
                                <th>Estatus</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Los TEGs se cargarán aquí con JavaScript -->
                        </tbody>
                    </table>
                </div>

                <div class="table-pagination">
                    <button class="prev-btn" disabled><i class="fas fa-chevron-left"></i> Anterior</button>
                    <span class="page-info">Página 1 de 1</span>
                    <button class="next-btn" disabled>Siguiente <i class="fas fa-chevron-right"></i></button>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>Biblioteca Digital</h3>
                <p>Repositorio institucional de trabajos especiales de grado del IUTTOL.</p>
            </div>
            <div class="footer-section">
                <h3>Enlaces Rápidos</h3>
                <ul>
                    <li><a href="consultas.html">Buscar TEGs</a></li>
                    <li><a href="formulario.html">Acceso administrativo</a></li>
                    <li><a href="https://www.instagram.com/iuttol_98/">Instagram</a></li>
                    <li><a href="https://www.facebook.com/iuttomaslander/?locale=es_LA">Facebook</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Contacto</h3>
                <p>biblioteca@iuttol.edu.ve</p>
                <p>(0239) 225 9474</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 Instituto Universitario de Tecnología "Tomás Lander". Todos los derechos reservados.</p>
        </div>
    </footer>

    <script type="module">
        import { login, checkAuth } from './js/auth.js'
        import { createTEG } from './js/teg-service.js'

        // Verificar si ya está autenticado
        async function init() {
            const user = await checkAuth()
            if (user) {
                document.getElementById('login-section').style.display = 'none'
                document.getElementById('admin-section').style.display = 'block'
            }
        }

        // Manejar login
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault()
            const email = document.getElementById('username').value
            const password = document.getElementById('password').value
            
            const result = await login(email, password)
            if (result.success) {
                document.getElementById('login-section').style.display = 'none'
                document.getElementById('admin-section').style.display = 'block'
            } else {
                alert('Error: ' + result.error)
            }
        })

        // Manejar registro de TEG
        document.getElementById('teg-registration-form').addEventListener('submit', async (e) => {
            e.preventDefault()
            
            const tegData = {
                titulo: document.getElementById('teg-titulo').value,
                carrera_id: document.getElementById('teg-carrera').value,
                autor: document.getElementById('teg-autor').value,
                tutor: document.getElementById('teg-tutor').value,
                resumen: document.getElementById('teg-resumen').value,
                fecha: document.getElementById('teg-fecha').value,
                estatus: document.getElementById('teg-status').value,
                archivo: document.getElementById('teg-archivo').files[0],
                palabras_clave: document.getElementById('teg-palabras-clave').value || ''
            }

            try {
                await createTEG(tegData)
                alert('TEG registrado con éxito!')
                e.target.reset()
            } catch (error) {
                alert('Error: ' + error.message)
            }
        })

        init()
    </script>
</body>
</html>